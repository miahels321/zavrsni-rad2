<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>Kalkulator tro≈°kova</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styletroskovi.css') }}">
     <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&family=Varela+Round&display=swap" rel="stylesheet">
    <style>
       
    </style>
</head>
<body>
    <div class="nav">
            <a href="/">Home</a>
            <a href="/reg">Registracija</a>
            <a href="/troskovi">Kalkulator tro≈°kova</a>
            <a href="/kviz">Kviz</a>
            <a href="/profil">Profil</a>
            
        </div>
<div class="container">
    <h2>Kalkulator tro≈°kova</h2>

    <div class="section">
        <label>Bud≈æet (‚Ç¨): <input type="number" id="budget" placeholder="npr. 300" /></label>
    </div>

    <div class="section">
        <strong>Kako ≈æeli≈° obraƒçunati prioritete?</strong><br>
        <label><input type="radio" name="mode" value="auto" checked> Automatski (maksimalan broj koji stane u bud≈æet)</label><br>
        <label><input type="radio" name="mode" value="manual"> Ruƒçno unosim broj puta</label>
    </div>

    <div id="expenses"></div>
    <button onclick="addExpense()">+ Dodaj tro≈°ak</button>
    <button onclick="calculate()">Izraƒçunaj</button>

    <div id="result" class="result"></div>
    <div id="job-suggestion" class="result"></div>
</div>
<footer><h1>Mihael ≈†u≈°koviƒá @2025</h1></footer>
<script>
let expenseCount = 0;

function addExpense(name = "", value = "", priority = false, count = "") {
    const div = document.createElement('div');
    div.className = 'expense-item';
    div.innerHTML = `
        <input type="text" id="name-${expenseCount}" placeholder="Naziv" value="${name}">
        <input type="number" id="value-${expenseCount}" placeholder="Cijena" value="${value}">
        <label><input type="checkbox" id="priority-${expenseCount}" ${priority ? 'checked' : ''}> Prioritet</label>
        <label>Broj puta: <input type="number" id="count-${expenseCount}" value="${count}" min="1"></label>
    `;
    document.getElementById("expenses").appendChild(div);
    expenseCount++;
}

window.onload = () => {
    addExpense("Kava", 2, true, 10);
    addExpense("Izlasci", 30, true, 5);
    addExpense("Odjeƒáa", 50, false, 1);
    addExpense("Gorivo", 60, false, 1);
};

function getSelectedMode() {
    return document.querySelector('input[name="mode"]:checked').value;
}

function calculate() {
    const budget = parseFloat(document.getElementById("budget").value);
    const mode = getSelectedMode();

    if (isNaN(budget) || budget <= 0) {
        alert("Unesi ispravan bud≈æet.");
        return;
    }

    const priorities = [];
    const others = [];
    let summary = [];
    let total = 0;

    for (let i = 0; i < expenseCount; i++) {
        const name = document.getElementById(`name-${i}`).value;
        const value = parseFloat(document.getElementById(`value-${i}`).value);
        const isPriority = document.getElementById(`priority-${i}`).checked;
        const countInput = parseInt(document.getElementById(`count-${i}`).value);

        if (!name || isNaN(value) || value <= 0) continue;

        const item = { name, value, isPriority, countInput };
        if (isPriority) priorities.push(item);
        else others.push(item);
    }

    
    for (const item of priorities) {
        let count = 0;
        if (mode === "manual" && !isNaN(item.countInput) && item.countInput > 0) {
            count = item.countInput;
        } else {
            count = Math.floor((budget - total) / item.value);
        }
        const cost = count * item.value;
        total += cost;
        summary.push(`<li><strong>${item.name}</strong> √ó ${count} ‚Üí ${cost.toFixed(2)} ‚Ç¨</li>`);
    }

    
    for (const item of others) {
        const count = isNaN(item.countInput) || item.countInput <= 0 ? 1 : item.countInput;
        const cost = count * item.value;
        total += cost;
        summary.push(`<li><strong>${item.name}</strong> √ó ${count} ‚Üí ${cost.toFixed(2)} ‚Ç¨</li>`);
    }

    const deficit = total - budget;

    document.getElementById("result").innerHTML = `
        <h3>Rezultat</h3>
        <p><strong>Ukupno potro≈°eno:</strong> ${total.toFixed(2)} ‚Ç¨</p>
        <p><strong>Bud≈æet:</strong> ${budget.toFixed(2)} ‚Ç¨</p>
        <ul>${summary.join("")}</ul>
    `;

    if (deficit > 0) {
        fetch("/api/posao", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ deficit })
        })
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                document.getElementById("job-suggestion").innerHTML = `<p class="not-enough">${data.error}</p>`;
            } else {
                document.getElementById("job-suggestion").innerHTML = `
                    <h4>üíº Nema≈° dovoljno novca!</h4>
                    <p>Preporuƒçeni posao: <strong>${data.naslov}</strong> (${data.satnica} ‚Ç¨/h)</p>
                    <p>${data.opis}</p>
                    <p>Potrebno odraditi: <strong>${data.sati} sati</strong></p>
                    <p>Kontakt: <a href="mailto:${data.kontakt}">${data.kontakt}</a></p>
                `;
            }
        });
    } else {
        document.getElementById("job-suggestion").innerHTML = "<p>‚úÖ Ima≈° dovoljno novca za sve svoje planove!</p>";
    }
}
</script>
</body>
</html>
